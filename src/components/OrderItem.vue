<template>
  <div class="order-container">
    <div class="header" flex="dir:left cross:center main:justify">
      <div class="order-time">
        {{item.createDate}}
      </div>
      <div class="order-state">
        {{item.status | stateFilter}}
      </div>
    </div>
    <div class="body">
      <div class="order-info" flex="dir:top box:mean">
        <div class="order-name" flex="dir:left cross:center">
          <span class="package-name">{{item.packageName}}</span>
        </div>
        <div class="car-info" flex="dir:left cross:center">
          <span class="car-type">车型：{{item.carType}}</span>
          <span class="engine-oil">机油：{{item.engineOil}}</span>
        </div>
      </div>
      <div class="price-info" flex="dir:left main:right cross:center">
        <div class="order-total" flex="dir:left">
          <div class="title">合计:￥</div>
          <div class="label">{{item.orderPrice}}</div>
        </div>
        <div class="order-price" flex="dir:left" v-if="item.status != 1">
          <div class="title">实付:￥</div>
          <div class="label">{{item.orderPrice}}</div>
        </div>
      </div>

    </div>
    <div class="footer">
      <div class="reamrkb" flex="dir:left cross:center" v-if="item.status == 5 && !!item.alterReamrk">
        <span class="">{{item.alterReamrk}}</span>
      </div>
      <div class="oprater" flex="dir:left cross:center main:right">

        <div class="pay" v-if="item.status == 1" v-tap="goPay.bind(this,item.orderNo)">去支付</div>
        <div class="cancel" v-if="item.status == 2 && new Date().getTime() - item.paySuccessDate < 604800000 && !item.isOrderDetail" v-tap="refund.bind(this,item.orderNo)">退款</div>
        <div class="goReceipt" v-tap="goReceipt.bind(this,item.orderNo)" v-if="item.isOpen=='Y'">我要发票</div>
        <div class="goReceipt" v-tap="goReceiptPic.bind(this,item.backup1)" v-if="item.isOpen=='YY'">查看发票</div>
        <!--<div class="evaluate" @click="goEvaluate" v-if="item.status == 4">去评价</div>-->
        <div class="detail" v-tap="viewDetail.bind(this,item.orderNo)">查看详情</div>
      </div>
    </div>
  </div>
</template>
<script>
import Tool from "../utils/Tool";
import { Toast } from "mint-ui";
export default {
  data() {
    return {};
  },
  props: {
    item: {
      type: Object,
      default: {}
    }
  },
  filters: {
    stateFilter: function(val) {
      switch (val) {
        case 0:
          return "已关闭";
          break;
        case 1:
          return "未支付";
          break;
        case 2:
          return "已支付";
          break;
        case 3:
          return "退款中";
          break;
        case 4:
          return "退款失败";
          break;
        case 5:
          return "退款成功";
          break;
      }
    },
    universalFilter: function(val) {
      if (val == 1) {
        return "全国服务门店使用";
      } else {
        return "指定服务门店使用";
      }
    }
  },
  methods: {
    viewDetail: function(id) {
      this.$router.push({ path: "orderdetail/" + id });
    },
    goEvaluate: function() {
      this.$router.push({ path: "evaluate" });
    },
    goPay: function(orderNo) {
      this.$router.push({ path: "/orderpay/" + orderNo });
    },
    refund: function(orderNo) {
      this.$router.push({ path: "/refund/" + orderNo });
    },
    goReceipt: function(orderNo) {
      // this.$router.push({name:'personreceipt',params:{needReceipt:this.userInfo.needReceipt,selectTitle:this.userInfo.selectTitle}});
      // needReceipt:'1', //1默认不要发票 selectTitle:'0', // 0代表个人

      // this.setReceiptInfo({needReceipt:1,selectTitle:'0',receiver:'',receMobile:'',zip:'',selectAddr:'',addressCont:'',comName:'',receiptCode:''}); //是否要清空
      this.$router.push({
        name: "personreceipt",
        params: { needReceipt: 1, selectTitle: 1, orderNo: orderNo }
      });
    },
    goReceiptPic: function(id) {
      // this.$router.push({name:'showreceipt',params:{id:id}});
      Tool.post("getInvoiceUrl", { id: id }, data => {
        if (data.code == 200) {
          // this.pdfSrc = data.data

          var url = encodeURI(`${data.data}&_t=${new Date().getTime()}`);
          console.log(url);
          window.open(url, "_system", "location=no");
        } else {
          Toast({
            duration: 1000,
            message: data.msg
          });
        }
      });
    }
  }
};
</script>
<style lang="less" scoped>
.order-container {
  font-size: 0.58rem;
  line-height: 1.5em;
  color: #222;
  .header {
    border-bottom: 1px solid #efefef;
    font-size: 0.58rem;
    line-height: 2em;
    .order-time {
      color: #888;
    }
    .order-state {
      color: #389cf1;
    }
  }
  .body {
    font-size: 0.67rem;
    .order-info {
      padding: 0.2rem 0;
      height: 2.6rem;
      border-bottom: 1px solid #efefef;
      .order-name {
        .package-range {
          font-size: 0.57rem;
          margin-left: 0.2rem;
          color: #fc4c1d;
        }
      }
      .car-info {
        font-size: 0.57rem;
        .car-type {
          margin-right: 0.4rem;
        }
        .engine-oil {
          font-size: 0.51rem;
          color: #888;
        }
      }
    }
    .price-info {
      height: 1.5rem;
      font-size: 0.54rem;
      border-bottom: 1px solid #efefef;
      .order-price {
        margin-left: 0.5rem;
      }
    }
  }
  .footer {
    position: relative;
    font-size: 0.51rem;
    color: #4b4b4b;
    .oprater {
      height: 1.5rem;

      & > div {
        margin-left: 0.5rem;
      }
      & > div {
        padding: 0.05rem 0.5rem;
        border: 1px solid #aaa;
        border-radius: 0.2rem;
      }
    }
    .reamrkb {
      line-height: 0.6rem;
      position: absolute;
      color: red;
      height: 1.5rem;
      width: 57%;
    }
  }
}
</style>
